# å¢å¼ºåˆ†æç³»ç»Ÿå®Œæ•´æŒ‡å—

## ğŸ“Š ç³»ç»Ÿæ¦‚è¿°

æœ¬å¢å¼ºåˆ†æç³»ç»Ÿä¸ºæ‚¨æä¾›äº†ä¸‰ä¸ªå±‚æ¬¡çš„åˆ†æè„šæœ¬ï¼š

1. **åŸå§‹åˆ†æ**ï¼šAGOP/NFM correlation + Train/Val Loss  
2. **å¢å¼ºåˆ†æ**ï¼šæ·»åŠ  $G_i$, $H_i$, $M_i$ çŸ©é˜µé—´çš„ä½™å¼¦ç›¸ä¼¼åº¦åˆ†æ
3. **å®Œæ•´æµ‹è¯•**ï¼šéªŒè¯ç³»ç»ŸåŠŸèƒ½çš„æ¼”ç¤ºè„šæœ¬

## ğŸ”¬ æ•°å­¦ç†è®ºåŸºç¡€

### çŸ©é˜µå®šä¹‰
- **$H_i := \mathbb{E}[h_i h_i^T]$**ï¼šè¡¨ç¤ºçŸ©é˜µï¼ˆRepresentation Matrixï¼‰
- **$G_i := \mathbb{E}[g_i g_i^T]$ï¼Œå…¶ä¸­ $g_i := -\nabla_{h_i} \ell$**ï¼šæ¢¯åº¦çŸ©é˜µï¼ˆGradient Matrixï¼‰  
- **$M_i := W_i^T W_i$**ï¼šæƒé‡çŸ©é˜µï¼ˆWeight Matrixï¼Œä¸NFMå®šä¹‰ç›¸åŒï¼‰

### ç›¸ä¼¼åº¦è®¡ç®—
æ‰€æœ‰ç›¸ä¼¼åº¦å‡ä½¿ç”¨**ä½™å¼¦ç›¸ä¼¼åº¦**ï¼ˆCosine Similarityï¼‰ï¼š
$$\text{similarity} = \frac{\langle \text{vec}(A), \text{vec}(B) \rangle}{||A||_F \cdot ||B||_F}$$

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. æµ‹è¯•ç³»ç»ŸåŠŸèƒ½ï¼ˆæ¨èç¬¬ä¸€æ­¥ï¼‰
```bash
# ç”Ÿæˆæ¼”ç¤ºæ•°æ®å’Œå¯è§†åŒ–
python test_enhanced_analysis.py
```
è¿™å°†åˆ›å»ºï¼š
- `experiments/` ç›®å½•ï¼ˆåŒ…å«æ¨¡æ‹Ÿçš„ä¸‰ä¸ªæ¨¡å‹ï¼‰
- `enhanced_analysis/demo_enhanced_analysis.png`ï¼ˆæ¼”ç¤ºå›¾è¡¨ï¼‰

### 2. åœ¨çœŸå®è®­ç»ƒæ¨¡å‹ä¸Šè¿è¡Œå¢å¼ºåˆ†æ
```bash
# åˆ†ææŒ‡å®šçš„ä¸‰ä¸ªæ¨¡å‹
python enhanced_analysis_visualization.py --models adam_20250803_173338 muon_20250804_041908 sgd_20250803_164335
```

## ğŸ“ æ–‡ä»¶ç»“æ„

```
deep_neural_feature_ansatz/
â”œâ”€â”€ enhanced_analysis_visualization.py  # ä¸»å¢å¼ºåˆ†æè„šæœ¬
â”œâ”€â”€ test_enhanced_analysis.py          # åŠŸèƒ½æµ‹è¯•è„šæœ¬  
â”œâ”€â”€ ENHANCED_ANALYSIS_GUIDE.md         # è¯¦ç»†ä½¿ç”¨æŒ‡å—
â”œâ”€â”€ experiments/                       # è®­ç»ƒæ¨¡å‹ç›®å½•
â”‚   â”œâ”€â”€ adam_20250803_173338/
â”‚   â”œâ”€â”€ muon_20250804_041908/
â”‚   â””â”€â”€ sgd_20250803_164335/
â””â”€â”€ enhanced_analysis/                 # åˆ†æç»“æœç›®å½•
    â”œâ”€â”€ demo_enhanced_analysis.png
    â”œâ”€â”€ adam_20250803_173338_enhanced_analysis.png
    â”œâ”€â”€ adam_20250803_173338_similarities.json
    â””â”€â”€ ...
```

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### åŸæœ‰æŒ‡æ ‡ï¼ˆå·²å­˜åœ¨ï¼‰
- âœ… AGOP/NFM Correlationï¼šAGOPä¸ç¥ç»ç‰¹å¾çŸ©é˜µçš„ä½™å¼¦ç›¸ä¼¼åº¦
- âœ… Train/Val Lossï¼šè®­ç»ƒå’ŒéªŒè¯æŸå¤±æ›²çº¿

### æ–°å¢æŒ‡æ ‡ï¼ˆæœ¬æ¬¡æ·»åŠ ï¼‰
- ğŸ†• **G vs H**ï¼šæ¢¯åº¦çŸ©é˜µä¸è¡¨ç¤ºçŸ©é˜µçš„ä½™å¼¦ç›¸ä¼¼åº¦
- ğŸ†• **G vs M**ï¼šæ¢¯åº¦çŸ©é˜µä¸æƒé‡çŸ©é˜µçš„ä½™å¼¦ç›¸ä¼¼åº¦  
- ğŸ†• **H vs M**ï¼šè¡¨ç¤ºçŸ©é˜µä¸æƒé‡çŸ©é˜µçš„ä½™å¼¦ç›¸ä¼¼åº¦

## ğŸ“Š å¯è§†åŒ–è¾“å‡º

æ¯ä¸ªæ¨¡å‹ç”Ÿæˆä¸€å¼ å›¾è¡¨ï¼ŒåŒ…å«ï¼š
- **5ä¸ªå­å›¾**ï¼šå¯¹åº”Layer 0-4
- **åŒyè½´è®¾è®¡**ï¼š
  - å·¦è½´ï¼šè®­ç»ƒå’ŒéªŒè¯æŸå¤±ï¼ˆå¯¹æ•°å°ºåº¦ï¼‰
  - å³è½´ï¼šå„ç§ä½™å¼¦ç›¸ä¼¼åº¦ï¼ˆ0-1èŒƒå›´ï¼‰
- **6æ¡æ›²çº¿**ï¼š
  - Train Lossï¼ˆè“è‰²â—ï¼‰
  - Val Lossï¼ˆçº¢è‰²â– ï¼‰  
  - AGOP/NFM Corrï¼ˆç»¿è‰²â–²ï¼‰
  - G vs Hï¼ˆç´«è‰²â™¦ï¼‰
  - G vs Mï¼ˆé’è‰²â–¼ï¼‰
  - H vs Mï¼ˆæ©™è‰²â˜…ï¼‰

## âš™ï¸ è‡ªå®šä¹‰ä½¿ç”¨

### ä¿®æ”¹æ¨¡å‹åˆ—è¡¨
```bash
# åˆ†æä¸åŒçš„æ¨¡å‹
python enhanced_analysis_visualization.py --models model1 model2 model3
```

### è‡ªå®šä¹‰ç›®å½•
```bash
# æŒ‡å®šè‡ªå®šä¹‰è·¯å¾„
python enhanced_analysis_visualization.py \
  --models adam_20250803_173338 muon_20250804_041908 sgd_20250803_164335 \
  --experiments_dir /path/to/experiments \
  --output_dir my_results
```

### å†…å­˜ä¼˜åŒ–ç‰ˆæœ¬
å¦‚æœå†…å­˜ä¸è¶³ï¼Œå¯ä»¥ä¿®æ”¹è„šæœ¬ä¸­çš„ `max_samples` å‚æ•°ï¼š
```python
# åœ¨ compute_matrix_similarities å‡½æ•°ä¸­
similarities = compute_matrix_similarities(model_path, layer_indices, max_samples=5000)
```

## â±ï¸ è¿è¡Œæ—¶é—´ä¼°è®¡

- **æµ‹è¯•è„šæœ¬**ï¼š< 1åˆ†é’Ÿ
- **å•ä¸ªæ¨¡å‹å¢å¼ºåˆ†æ**ï¼š30-60åˆ†é’Ÿï¼ˆå–å†³äºæ£€æŸ¥ç‚¹æ•°é‡ï¼‰
- **ä¸‰ä¸ªæ¨¡å‹å®Œæ•´åˆ†æ**ï¼š1.5-3å°æ—¶

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜
1. **æ¨¡å‹ç›®å½•ä¸å­˜åœ¨**
   ```
   Model directory not found: experiments/model_name
   ```
   **è§£å†³**ï¼šæ£€æŸ¥æ¨¡å‹ç›®å½•åç§°å’Œè·¯å¾„

2. **æ£€æŸ¥ç‚¹æ–‡ä»¶ç¼ºå¤±**
   ```
   Model not found for epoch X  
   ```
   **è§£å†³**ï¼šç¡®ä¿ `models/` å­ç›®å½•ä¸­æœ‰å¯¹åº”çš„ `.pt` æ–‡ä»¶

3. **å†…å­˜ä¸è¶³**
   **è§£å†³**ï¼šä¿®æ”¹ `max_samples` å‚æ•°é™åˆ¶æ ·æœ¬æ•°é‡

### ä¾èµ–æ£€æŸ¥
```bash
pip install torch matplotlib seaborn numpy
```

## ğŸ“ˆ å®é™…ä½¿ç”¨å·¥ä½œæµ

### æ ‡å‡†å·¥ä½œæµ
1. **è®­ç»ƒæ¨¡å‹**ï¼š
   ```bash
   python colab_training_analysis.py  # æˆ–å…¶ä»–è®­ç»ƒè„šæœ¬
   ```

2. **æµ‹è¯•åŠŸèƒ½**ï¼š
   ```bash
   python test_enhanced_analysis.py
   ```

3. **å¢å¼ºåˆ†æ**ï¼š
   ```bash
   python enhanced_analysis_visualization.py --models your_model1 your_model2 your_model3
   ```

4. **ç»“æœåˆ†æ**ï¼š
   - æŸ¥çœ‹ `enhanced_analysis/` ç›®å½•ä¸­çš„PNGå›¾è¡¨
   - åˆ†æ `*_similarities.json` æ–‡ä»¶ä¸­çš„åŸå§‹æ•°æ®

## ğŸ“ ç†è®ºæ„ä¹‰

### åˆ†æä»·å€¼
- **G vs H**ï¼šæ­ç¤ºæ¢¯åº¦æµä¸è¡¨ç¤ºå­¦ä¹ çš„å…³ç³»
- **G vs M**ï¼šç†è§£æ¢¯åº¦å¦‚ä½•å¡‘é€ æƒé‡ç»“æ„
- **H vs M**ï¼šè¡¨ç¤ºç©ºé—´ä¸å‚æ•°ç©ºé—´çš„å¯¹åº”å…³ç³»

### é¢„æœŸæ¨¡å¼
- è®­ç»ƒåˆæœŸï¼šç›¸ä¼¼åº¦è¾ƒä½ï¼Œå„çŸ©é˜µç›¸å¯¹ç‹¬ç«‹
- è®­ç»ƒä¸­æœŸï¼šç›¸ä¼¼åº¦é€æ¸ä¸Šå‡ï¼Œå¼€å§‹å½¢æˆç»“æ„å¯¹åº”
- è®­ç»ƒåæœŸï¼šç›¸ä¼¼åº¦è¶‹äºç¨³å®šï¼Œåæ˜ å­¦ä¹ åˆ°çš„ç‰¹å¾ç»“æ„

## ğŸ“ å¼•ç”¨å’Œæ‰©å±•

è¯¥ç³»ç»ŸåŸºäºç¥ç»ç‰¹å¾å‡è®¾ï¼ˆNeural Feature Ansatzï¼‰ç†è®ºï¼Œæ”¯æŒï¼š
- å¤šä¼˜åŒ–å™¨æ¯”è¾ƒï¼ˆSGD, Adam, Muonï¼‰
- å¤šå±‚åˆ†æï¼ˆLayer 0-4ï¼‰
- å®Œæ•´è®­ç»ƒè½¨è¿¹è·Ÿè¸ª

å¯æ‰©å±•ç”¨äºç ”ç©¶ï¼š
- ä¸åŒç½‘ç»œæ¶æ„çš„è¡Œä¸ºå·®å¼‚
- ä¼˜åŒ–å™¨å¯¹ç‰¹å¾å­¦ä¹ çš„å½±å“  
- è®­ç»ƒåŠ¨åŠ›å­¦çš„ç†è®ºéªŒè¯

---

**ç«‹å³å¼€å§‹**ï¼šè¿è¡Œ `python test_enhanced_analysis.py` ä½“éªŒå¢å¼ºåˆ†æç³»ç»Ÿï¼
